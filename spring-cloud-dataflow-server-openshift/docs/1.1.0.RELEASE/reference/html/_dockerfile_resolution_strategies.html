<html><head>
      <meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
   <title>11.&nbsp;Dockerfile Resolution Strategies</title><link rel="stylesheet" type="text/css" href="css/manual-multipage.css"><meta name="generator" content="DocBook XSL Stylesheets V1.78.1"><link rel="home" href="index.html" title="Spring Cloud Data Flow Server for OpenShift"><link rel="up" href="configuration.html" title="Part&nbsp;IV.&nbsp;Configuration"><link rel="prev" href="_maven_configuration.html" title="10.&nbsp;Maven Configuration"><link rel="next" href="server.html" title="Part&nbsp;V.&nbsp;Server Implementation"></head><body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF"><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">11.&nbsp;Dockerfile Resolution Strategies</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="_maven_configuration.html">Prev</a>&nbsp;</td><th width="60%" align="center">Part&nbsp;IV.&nbsp;Configuration</th><td width="20%" align="right">&nbsp;<a accesskey="n" href="server.html">Next</a></td></tr></table><hr></div><div class="chapter"><div class="titlepage"><div><div><h2 class="title"><a name="_dockerfile_resolution_strategies" href="#_dockerfile_resolution_strategies"></a>11.&nbsp;Dockerfile Resolution Strategies</h2></div></div></div><p>The Data Flow Server for OpenShift uses the <a class="link" href="https://docs.openshift.org/latest/dev_guide/builds.html#docker-strategy-options" target="_top">Docker build strategy</a>.
The default strategy for resolving a Dockerfile is to use the built in Dockerfile included in the OpenShift deployer.
However, there are three other strategies available:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem">If a remote Git URI is specified when creating the stream/task definition using the <code class="literal">spring.cloud.deployer.openshift.build.git.uri</code> property, this repository will be used and takes highest precedence.</li><li class="listitem">If <code class="literal">src/main/docker/Dockerfile</code> is detected in the Maven artifact Jar, then it is assumed that the <code class="literal">Dockerfile</code> will exist in that location in a remote Git repository.
In that case, the <a class="link" href="https://docs.openshift.org/latest/dev_guide/builds.html#source-code" target="_top">Git repository source</a> is used in conjunction with the Docker build strategy.
The remote Git URI and ref are extracted from the <code class="literal">&lt;scm&gt;&lt;connection&gt;&lt;/connection&gt;&lt;/scm&gt;</code> and <code class="literal">&lt;scm&gt;&lt;tag&gt;&lt;/tag&gt;&lt;/scm&gt;</code> tags in the <code class="literal">pom.xml</code> (if available) of the Maven Jar artifact.
For example, if the <code class="literal">&lt;scm&gt;&lt;connection&gt;</code> value was <code class="literal">scm:git:git@github.com:spring-cloud/spring-cloud-dataflow.git</code>,
then the remote Git URI would be parsed as <code class="literal">ssh://git@github.com:spring-cloud/spring-cloud-dataflow.git</code>.
In short, the <code class="literal">Dockerfile</code> from the remote Git repository for the app being deployed will be
used (OpenShift actually clones the Git repo) as the source for the image build.
Of course, you can include and customise whatever and however you like in this <code class="literal">Dockerfile</code>.</li><li class="listitem"><p class="simpara">The other strategy uses the contents of a <code class="literal">Dockerfile</code> located in one of three locations as the <a class="link" href="https://docs.openshift.org/latest/dev_guide/builds.html#dockerfile-source" target="_top">Dockerfile source</a>:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem">The file system location of a Dockerfile indicated by the <code class="literal">spring.cloud.deployer.openshift.deployment.dockerfile</code> deployment property.
E.g. <code class="literal">--properties "spring.cloud.deployer.openshift.deployment.dockerfile=/tmp/deployer/Dockerfile"</code>. The <span class="strong"><strong>contents</strong></span> of this file will be used as the source input for the build.</li><li class="listitem">The inline Dockerfile content as provided in the <code class="literal">spring.cloud.deployer.openshift.deployment.dockerfile</code> deployment property.
E.g. <code class="literal">--properties "spring.cloud.deployer.openshift.deployment.dockerfile=FROM java:8\n RUN wget &#8230;&#8203;"</code></li><li class="listitem">The default Dockerfile provided by the OpenShift deployer.</li></ul></div></li></ul></div></div><div class="navfooter"><hr><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="_maven_configuration.html">Prev</a>&nbsp;</td><td width="20%" align="center"><a accesskey="u" href="configuration.html">Up</a></td><td width="40%" align="right">&nbsp;<a accesskey="n" href="server.html">Next</a></td></tr><tr><td width="40%" align="left" valign="top">10.&nbsp;Maven Configuration&nbsp;</td><td width="20%" align="center"><a accesskey="h" href="index.html">Home</a></td><td width="40%" align="right" valign="top">&nbsp;Part&nbsp;V.&nbsp;Server Implementation</td></tr></table></div></body></html>